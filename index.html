<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- bootstrap styling -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">


  <!-- google icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <title>PPM Visualization</title>

  <style>
    html,
    body {
      background-color: #3b414d;
      font-family: Arial;
      width: 100%;
      margin: 0;
      padding: 0;
    }

    h1 {
      font-size: 38px;
      color: #fff;
      margin: 25px 0 25px 0;
    }

    p {
      color: #FFFFFF;
      max-width: 500px;
      margin: 0 auto;
      padding: 5px 15px 5px 15px;
    }

    canvas {
      background-color: #FFFFFF;
      border: 1px solid grey;
      margin: 0 auto 2.5vw auto;
    }

    #container {
      margin: 0 auto;
      text-align: center;
      overflow: auto;
    }

    #range-value {
      color: #FFFFFF
    }

    #input-container {
      width: 90vw;
      max-width: 400px;
      background-color: #ffffff;
      padding: 20px;
      margin: 0 auto 20px auto;
      border-radius: 5px;
      text-align: left;
    }

    .info-icon:hover {
      color: #007bff;
      cursor: pointer;
    }

    @media only screen and (max-width: 500px) {
      h1 {
        font-size: 34px;
      }
    }
  </style>
</head>

<body onresize="windowResize()">
  <div id="container">
    <h1>PPM Visualization</h1>

    <div id="input-container">
      <div class="form-group">
        <label class="col-form-label col-form-label-sm" for="number-of-dots">Select PPM (1 - 10000)</label>
        <input class="form-control form-control-sm" type="number" id="number-of-dots" name="number-of-dots" min="1" max="10000" value="400" autofocus>
      </div>

      <hr>

      <div class="form-group">
        <label class="col-form-label col-form-label-sm" for="ppm-color">Select Color</label>
        <input class="form-control form-control-sm" type="color" id="ppm-color" name="ppm-color" value="#a10067">
      </div>

      <hr>

      <div class="form-group">

        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" id="gas" name="statetype" value="300" checked>
          <label for="gas" class="form-check-label">gas</label>
        </div>

        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" id="liquid-solid>" name="statetype" value="100">
          <label for="liquid-solid" class="form-check-label">liquid &#x2f; solid</label>
        </div>



      </div>

      <hr>

      <div>
        <button type="button" class="btn btn-primary btn-sm" id="runPPM">Calculate PPM</button>
      </div>
      

    </div>

    <canvas id="canvas"></canvas>


  </div>

  <script>
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    ctx.canvas.width = window.innerWidth > 900 ? 860 : window.innerWidth * .9;
    ctx.canvas.height = window.innerWidth > 900 ? 860 : window.innerWidth * .9; // set height same as width for simplicity
    var width = canvas.width;
    var height = canvas.height;
    var xCenter = width / 2; // X center position for rotation calculation
    var zCenter = width / 2; // Z center position for rotation calculation
    var blockWidth = width * .6; // set volume(block) width as a percentage of canvas width
    var blockHeight = height * .6; // set volume(block) height as a percentage of canvas height
    var dots; // array to hold all dots
    var frame; // contains the animation frame
    var rotationSpeed = 0.01; // value is in radians
    var numberOfDots = Number(document.getElementById('number-of-dots').value); // get initial number of dots
    var particleColor = document.getElementById('ppm-color').value; // get initial particle color
    var stateType = document.querySelector('input[name="statetype"]:checked').value; // get initial radio button selection for gas or solid/liquid
    var maxRange = Number(document.getElementById('number-of-dots').max); // get max number of particles


    class Particle {
      constructor() {
        this.x = (Math.random() * blockWidth) + ((width - blockWidth) / 2);
        this.y = (Math.random() * blockHeight) + ((height - blockHeight) / 2);
        this.z = (Math.random() * blockWidth) + ((width - blockWidth) / 2); // set z depth same as width
        this.yAdjusted; // to hold y position based on depth perspective
      }
      rotate() {
        let tempX = ((this.x - xCenter) * Math.cos(rotationSpeed)) - ((this.z - zCenter) * Math.sin(rotationSpeed));
        let tempZ = ((this.z - zCenter) * Math.cos(rotationSpeed)) + ((this.x - xCenter) * Math.sin(rotationSpeed));
        this.x = tempX + xCenter;
        this.z = tempZ + zCenter;

        let perspectiveRatio = ((zCenter - this.y) / (blockHeight / 2)); // gives a number between -1 and 1 to represent how far from Y center particle is
        let zRatio = (this.z - (width / 2)) / (blockWidth / 2); // gives a number from -1 to 1 to represent particle depth
        let magnitude = 30; // multiplier to apply to perspectiveRatio and zRatio
        this.yAdjusted = this.y + (perspectiveRatio * zRatio * magnitude);
      }
      draw() {
        let particleWidth = blockWidth / stateType; // 100 = solid-liquid, 300 = gas
        ctx.globalAlpha = Math.abs(1 - ((this.z / width) / 1.3));
        ctx.beginPath();
        ctx.arc(this.x, this.yAdjusted, particleWidth, 0, 360);
        ctx.fillStyle = particleColor;
        ctx.fill();
        ctx.closePath();
      }
    }


    // make requisite number of dots
    function makeDots() {
      numberOfDots = document.getElementById('number-of-dots').value; // get current number of dots
      particleColor = document.getElementById('ppm-color').value; // get current color
      stateType = document.querySelector('input[name="statetype"]:checked').value; // get if gas or solid/liquid

      if (numberOfDots <= maxRange && numberOfDots >= 1) { // if numberOfDots is in range
        dots = []; // erase existing dots

        for (let i = 0; i < numberOfDots; i++) {
          dots.push(new Particle())
        }
      }

    }


    // on window resize reset canvas width and height and recalculate all relevant sizes
    function windowResize() {
      ctx.canvas.width = window.innerWidth > 900 ? 860 : window.innerWidth * .95;
      ctx.canvas.height = window.innerWidth > 900 ? 860 : window.innerWidth * .95; // set height same as width for simplicity
      width = canvas.width;
      height = canvas.height;
      xCenter = width / 2; // X center position for rotation calculation
      zCenter = height / 2; // Y center position for rotation calculation
      blockWidth = width * .6; // set volume(block) width as a percentage of canvas width
      blockHeight = height * .6;
      window.cancelAnimationFrame(frame); // cancel current animation frame
      makeDots();
      window.requestAnimationFrame(calculatePPM);
    }



    // draw all the dots to the canvas
    function calculatePPM() {
      ctx.clearRect(0, 0, width, height);

      for (let j = 0; j < dots.length; j++) {
        dots[j].rotate();
        dots[j].draw();
      }

      frame = window.requestAnimationFrame(calculatePPM)
    }



    // when 'Calculate PPM' button is clicked run calculatePPM function
    document.getElementById("runPPM").onclick = function() {
      window.cancelAnimationFrame(frame); // cancel current animation frame
      makeDots(); // make a new set of dots based on new user settings
      window.requestAnimationFrame(calculatePPM); // request new animation frame and run it
    }


    // run initial program
    makeDots();
    window.requestAnimationFrame(calculatePPM);

  </script>
</body>

</html>
